<title>Twitter threads</title>

<meta charset='utf-8'>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src='thread-list.json'></script>

<style>
  body {
    font-family: system-ui, -apple-system;
    line-height: 1.6;

    --gray: hsl(0, 0%, 50%);
    --ui-divider: hsl(210, 40%, 90%);
    --visited-link: hsl(230, 40%, 60%);

    padding: 1em 3em;
    padding-bottom: 2em;

    font-size: 18px;

    counter-reset: threads;
  }
  @media screen and (max-width: 767px) {
    body {
      padding-left: 2em;
      padding-right: .5em;
      
      font-size: 15px;
    }
  }
  a {
    color: inherit;
  }
  h1 {
    font-size: 180%;
    font-weight: 900;
    padding: 0;
    margin: 0;
    line-height: 1.2;
    margin-bottom: .2em;
  }
  h2 {
    font-size: 100%;
    font-weight: 400;
    padding: 0;
    margin: 0;
  }
  h2 a {
    white-space: nowrap;
  }

  .threads {
    max-width: 40em;
    padding: 0;
    margin: 0;
  }
  .threads > li {
    list-style: none;
    padding: 0;
    margin: 0;
    padding-top: 2em;
    margin-top: 2em;
    border-top: 1px solid var(--ui-divider);

    counter-increment: threads;
  }
  .threads > li:before {
    position: absolute;
    content: counter(threads) ".";
    display: inline-block;
    font-weight: 300;
    
    color: var(--gray);

    padding: 0;
    margin: 0;
    width: 4.5em;
    margin-left: -5em;
    box-sizing: border-box;

    text-align: right;
  }

  .threads > li > a {
    text-decoration: inherit;
    color: inherit;
  }

  .threads > li .count {
    color: var(--gray);
    border: 1px solid var(--gray);
    padding: .2em .4em;
    margin-left: .2em;
    white-space: nowrap;
  }
  .threads > li .count:before {
    content: '+';
  }
  .threads > li .count:after {
    content: ' tweets';
  }

  .threads > li > a:visited {
    color: var(--visited-link);
  }
  .threads > li > a:visited .count {
    color: var(--visited-link);
    border-color: var(--visited-link);
  }

  .threads .image {
    width: 5.65em;
    height: 5.65em;
    margin-top: 1em;
    margin-right: 1em;
    outline: 1px solid var(--ui-divider);
    overflow: hidden;
    display: inline-block;

    background-size: cover;
    background-repeat: no-repeat;
    background-position: 50% 50%;
  }
  .threads .image img {
    width: 5em;
  }

  .meta {
    font-size: 80%;
    margin-top: .4em;
    color: var(--gray);
  }

  footer {
    font-size: 80%;
    margin-top: 10em;
    color: var(--gray);
  }
</style>

<body>
  <header>
    <h1></h1>
    <h2></h2>
  </header>
  <ol class='threads'></ol>
  <footer>
    Generated by <a target='_blank' href='https://github.com/mwichary/twitter-thread-list'>Twitter thread list</a> by Marcin Wichary.
  </footer>
</body>

<script>
  function processText(text) {
    // Remove the URL at the end
    text = text.replace(/https:\/\/t.co\/([a-zA-Z0-9]*)$/, '')

    // Do proper newlines
    text = text.replace(/\n/g, '<br>')

    return text
  }

  function formatDateTime(time) {
    return new Date(time).toDateString()
  }

  function formatNumber(number) {
    return number.toLocaleString('en')  
  }

  function main() {
    let title = `${data.account.accountDisplayName}’s Twitter threads`

    document.title = title
    document.querySelector('h1').innerHTML = title
    document.querySelector('h2').innerHTML = `
      Last updated: ${formatDateTime(data.account.lastUpdated)} · 
      <a target='_blank' href='https://twitter.com/${data.account.username}/'>Go to Twitter profile</a>
    `

    for (var i in data.tweets) {
      const tweet = data.tweets[i]

      const el = document.createElement('li')
      el.innerHTML = `
        <a target='_blank' href='https://twitter.com/${data.account.username}/status/${tweet.id_str}'>
          <div class='text'>${processText(tweet.full_text)} <span class='count'>${tweet.thread_length - 1}</span></div>
          <div class='meta'>
            ${formatDateTime(tweet.created_at)} ·
            ${formatNumber(tweet.retweet_count_combined)}&nbsp;retweets ·
            ${formatNumber(tweet.favorite_count_combined)}&nbsp;favourites
          </div>
        </a>
      `

      for (var j in tweet.images_combined) {
        const imageEl = document.createElement('div')
        imageEl.classList.add('image')
        imageEl.style.backgroundImage = `url('${tweet.images_combined[j]}')`

        el.querySelector('a').appendChild(imageEl)
      }

      document.querySelector('.threads').appendChild(el)
    }
  }

  main()
</script>
